/*!
 * vuexfire v2.3.0
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VuexFire={})}(this,function(e){"use strict";function t(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){return"function"==typeof e.key?e.key():e.key}function i(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function o(e){var t=e.val(),i=n(t)?t:{".value":t};return i[".key"]=r(e),i}function a(e){var t=e.data();return t[".id"]=e.id,t}function c(e){return"collection"in e}function d(e){this.unbind=e}function u(e){var t=this;this.listeners={},this.unbind=function(){for(var n in t.listeners)e.off(n,t.listeners[n])},this.addListeners=function(e){Object.assign(t.listeners,e)}}function s(e){var t=e.key,n=e.source,r=e.onErrorCallback,i=e.wait,o=e.commit,c=e.state,d=[],u=function(){o(b,{type:b,state:c,key:t,value:d},I)};return i?n.get().then(u):u(),n.onSnapshot(function(e){e.docChanges.forEach(function(e){switch(e.type){case"added":o(p,{type:p,state:c,key:t,index:e.newIndex,array:i&&d,record:a(e.doc)},I);break;case"modified":var n=a(e.doc);o(h,{type:h,state:c,key:t,index:e.oldIndex,array:i&&d,record:n},I),e.newIndex!==e.oldIndex&&o(E,{type:E,state:c,key:t,index:e.oldIndex,newIndex:e.newIndex,array:i&&d,record:n},I);break;case"removed":o(x,{type:x,state:c,key:t,index:e.oldIndex,array:i&&d},I)}})},r)}function f(e){var t=e.key,n=e.source,r=e.onErrorCallback,i=e.commit,o=e.state;return n.onSnapshot(function(e){i(m,{type:m,key:t,record:a(e),state:o},I)},r)}function l(e){var t=e.state,r=e.commit,i=e.key,o=e.source,a=e.options,u=a.readyCallback,l=a.errorCallback,y=a.wait;void 0===y&&(y=!0);var v=a.includeMetadataChanges;if(void 0===v&&(v=!0),!n(o))throw new Error("VuexFire: invalid Firebase binding source.");if(!(i in t))throw new Error("VuexFire: cannot bind undefined property '"+i+"'. Define it on the state first.");w.delete({commit:r,key:i}),u&&o.get().then(u);var k;k=c(o)?f({key:i,source:o,onErrorCallback:l,commit:r,state:t,includeMetadataChanges:v}):s({key:i,source:o,onErrorCallback:l,wait:y,commit:r,state:t,includeMetadataChanges:v}),w.add({commit:r,key:i,binding:new d(k)})}function y(e){var t=e.key,n=e.source,r=e.cancelCallback,i=e.commit,a=e.state;return{value:n.on("value",function(e){i(m,{type:m,key:t,record:o(e),state:a},g)},r)}}function v(e){var n=e.key,i=e.source,a=e.cancelCallback,c=e.wait,d=e.commit,u=e.state,s=[],f=function(){d(b,{type:b,state:u,key:n,value:s},g)};c?i.once("value",f):f();var l=i.on("child_added",function(e,r){var i=r?t(s,r)+1:0;d(p,{type:p,state:u,key:n,index:i,array:c&&s,record:o(e)},g)},a),y=i.on("child_removed",function(e){var i=t(s,r(e));d(x,{type:x,state:u,key:n,index:i,array:c&&s},g)},a);return{child_added:l,child_changed:i.on("child_changed",function(e){var i=t(s,r(e));d(h,{type:h,state:u,key:n,index:i,array:c&&s,record:o(e)},g)},a),child_removed:y,child_moved:i.on("child_moved",function(e,i){var a=t(s,r(e)),f=i?t(s,i)+1:0;d(E,{type:E,state:u,key:n,index:a,newIndex:f+=a<f?-1:0,array:c&&s,record:o(e)},g)},a)}}function k(e){var t=e.state,r=e.commit,o=e.key,a=e.source,c=e.options,d=c.cancelCallback,s=c.readyCallback,f=c.errorCallback,l=c.wait;if(void 0===l&&(l=!0),!n(a))throw new Error("VuexFire: invalid Firebase binding source.");if(!(o in t))throw new Error("VuexFire: cannot bind undefined property '"+o+"'. Define it on the state first.");var k=new u(i(a));w.add({commit:r,key:o,binding:k}),(s||f)&&a.once("value",s,f);var m;m=t[o]&&"length"in t[o]?v({key:o,source:a,cancelCallback:d,wait:l,commit:r,state:t}):y({key:o,source:a,cancelCallback:d,commit:r,state:t}),k.addListeners(m)}var m="vuexfire/OBJECT_VALUE",b="VUEXFIRE_ARRAY_INITIALIZE",p="vuexfire/ARRAY_ADD",h="vuexfire/ARRAY_CHANGE",E="vuexfire/ARRAY_MOVE",x="vuexfire/ARRAY_REMOVE",R=Object.freeze({VUEXFIRE_OBJECT_VALUE:m,VUEXFIRE_ARRAY_INITIALIZE:b,VUEXFIRE_ARRAY_ADD:p,VUEXFIRE_ARRAY_CHANGE:h,VUEXFIRE_ARRAY_MOVE:E,VUEXFIRE_ARRAY_REMOVE:x}),A={};A[m]=function(e,t){var n=t.key,r=t.record;e[n]=r},A[b]=function(e,t){var n=t.key,r=t.value;e[n]=r},A[p]=function(e,t){var n=t.key,r=t.index,i=t.record,o=t.array;(o=o||e[n]).splice(r,0,i)},A[h]=function(e,t){var n=t.key,r=t.index,i=t.record,o=t.array;(o=o||e[n]).splice(r,1,i)},A[E]=function(e,t){var n=t.key,r=t.index,i=t.newIndex,o=t.array;(o=o||e[n]).splice(i,0,o.splice(r,1)[0])},A[x]=function(e,t){var n=t.key,r=t.index,i=t.array;(i=i||e[n]).splice(r,1)};var _=new WeakMap,w=new function(){var e=this;this.add=function(t){var n=t.commit,r=t.key,i=t.binding;e.delete({commit:n,key:r}),e.get({commit:n})[r]=i},this.delete=function(t){var n=t.commit,r=t.key,i=e.get({commit:n}),o=i[r];o&&(o.unbind(),delete i[r])},this.get=function(e){var t=e.commit,n=_.get(t);return n||(n=Object.create(null),_.set(t,n)),n}},I={root:!0},g={root:!0},C={};Object.keys(R).forEach(function(e){var t=R[e];C[t]=function(e,n){A[t](n.state,n)}}),e.firebaseMutations=C,e.firebaseAction=function(e){return function(t,n){var r=t.state,i=t.commit;return t.bindFirebaseRef=function(e,t,n){return void 0===n&&(n={}),k({state:r,commit:i,key:e,source:t,options:n})},t.bindFirestoreRef=function(e,t,n){return void 0===n&&(n={}),l({state:r,commit:i,key:e,source:t,options:n})},t.unbindFirebaseRef=function(e){return w.delete({commit:i,key:e})},e(t,n)}},Object.defineProperty(e,"__esModule",{value:!0})});