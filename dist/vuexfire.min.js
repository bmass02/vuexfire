/*!
 * vuexfire v2.3.0
 * (c) 2018 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VuexFire={})}(this,function(e){"use strict";function t(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){if("function"!=typeof e)throw new Error("Must pass a function.");var t=function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];e.apply(void 0,n),t=function(){}};return t}function i(e){return"function"==typeof e.key?e.key():e.key}function o(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function a(e){var t=e.val(),r=n(t)?t:{".value":t};return r[".key"]=i(e),r}function c(e){var t=e.exists?e.data():Object.create(null);return t[".id"]=e.id,t}function d(e){return"collection"in e}function u(e){this.unbind=e}function s(e){var t=this;this.listeners={},this.unbind=function(){for(var n in t.listeners)e.off(n,t.listeners[n])},this.addListeners=function(e){Object.assign(t.listeners,e)}}function f(e){var t=e.key,n=e.source,r=e.onReadyCallback,i=e.onErrorCallback,o=e.wait,a=e.commit,d=e.state,u=[],s=function(){a(p,{type:p,state:d,key:t,value:u},I)};return o?n.get().then(s):s(),n.onSnapshot(function(e){e.docChanges.forEach(function(e){switch(e.type){case"added":a(h,{type:h,state:d,key:t,index:e.newIndex,array:o&&u,record:c(e.doc)},I);break;case"modified":var n=c(e.doc);a(E,{type:E,state:d,key:t,index:e.oldIndex,array:o&&u,record:n},I),e.newIndex!==e.oldIndex&&a(x,{type:x,state:d,key:t,index:e.oldIndex,newIndex:e.newIndex,array:o&&u,record:n},I);break;case"removed":a(R,{type:R,state:d,key:t,index:e.oldIndex,array:o&&u},I)}}),r(e)},i)}function l(e){var t=e.key,n=e.source,r=e.onReadyCallback,i=e.onErrorCallback,o=e.commit,a=e.state;return n.onSnapshot(function(e){o(b,{type:b,key:t,record:c(e),state:a},I),r(e)},i)}function y(e){var t=e.state,i=e.commit,o=e.key,a=e.source,c=e.options,s=c.readyCallback;void 0===s&&(s=function(){});var y=c.errorCallback;void 0===y&&(y=function(){});var v=c.wait;void 0===v&&(v=!0);var k=c.includeMetadataChanges;if(void 0===k&&(k=!0),!n(a))throw new Error("VuexFire: invalid Firebase binding source.");if(!(o in t))throw new Error("VuexFire: cannot bind undefined property '"+o+"'. Define it on the state first.");C.delete({commit:i,key:o});var m,b=r(s);m=d(a)?l({key:o,source:a,onReadyCallback:b,onErrorCallback:y,commit:i,state:t,includeMetadataChanges:k}):f({key:o,source:a,onReadyCallback:b,onErrorCallback:y,wait:v,commit:i,state:t,includeMetadataChanges:k}),C.add({commit:i,key:o,binding:new u(m)})}function v(e){var t=e.key,n=e.source,r=e.cancelCallback,i=e.commit,o=e.state;return{value:n.on("value",function(e){i(b,{type:b,key:t,record:a(e),state:o},g)},r)}}function k(e){var n=e.key,r=e.source,o=e.cancelCallback,c=e.wait,d=e.commit,u=e.state,s=[],f=function(){d(p,{type:p,state:u,key:n,value:s},g)};c?r.once("value",f):f();var l=r.on("child_added",function(e,r){var i=r?t(s,r)+1:0;d(h,{type:h,state:u,key:n,index:i,array:c&&s,record:a(e)},g)},o),y=r.on("child_removed",function(e){var r=t(s,i(e));d(R,{type:R,state:u,key:n,index:r,array:c&&s},g)},o);return{child_added:l,child_changed:r.on("child_changed",function(e){var r=t(s,i(e));d(E,{type:E,state:u,key:n,index:r,array:c&&s,record:a(e)},g)},o),child_removed:y,child_moved:r.on("child_moved",function(e,r){var o=t(s,i(e)),f=r?t(s,r)+1:0;d(x,{type:x,state:u,key:n,index:o,newIndex:f+=o<f?-1:0,array:c&&s,record:a(e)},g)},o)}}function m(e){var t=e.state,r=e.commit,i=e.key,a=e.source,c=e.options,d=c.cancelCallback,u=c.readyCallback,f=c.errorCallback,l=c.wait;if(void 0===l&&(l=!0),!n(a))throw new Error("VuexFire: invalid Firebase binding source.");if(!(i in t))throw new Error("VuexFire: cannot bind undefined property '"+i+"'. Define it on the state first.");var y=new s(o(a));C.add({commit:r,key:i,binding:y}),(u||f)&&a.once("value",u,f);var m;m=t[i]&&"length"in t[i]?k({key:i,source:a,cancelCallback:d,wait:l,commit:r,state:t}):v({key:i,source:a,cancelCallback:d,commit:r,state:t}),y.addListeners(m)}var b="vuexfire/OBJECT_VALUE",p="VUEXFIRE_ARRAY_INITIALIZE",h="vuexfire/ARRAY_ADD",E="vuexfire/ARRAY_CHANGE",x="vuexfire/ARRAY_MOVE",R="vuexfire/ARRAY_REMOVE",A=Object.freeze({VUEXFIRE_OBJECT_VALUE:b,VUEXFIRE_ARRAY_INITIALIZE:p,VUEXFIRE_ARRAY_ADD:h,VUEXFIRE_ARRAY_CHANGE:E,VUEXFIRE_ARRAY_MOVE:x,VUEXFIRE_ARRAY_REMOVE:R}),_={};_[b]=function(e,t){var n=t.key,r=t.record;e[n]=r},_[p]=function(e,t){var n=t.key,r=t.value;e[n]=r},_[h]=function(e,t){var n=t.key,r=t.index,i=t.record,o=t.array;(o=o||e[n]).splice(r,0,i)},_[E]=function(e,t){var n=t.key,r=t.index,i=t.record,o=t.array;(o=o||e[n]).splice(r,1,i)},_[x]=function(e,t){var n=t.key,r=t.index,i=t.newIndex,o=t.array;(o=o||e[n]).splice(i,0,o.splice(r,1)[0])},_[R]=function(e,t){var n=t.key,r=t.index,i=t.array;(i=i||e[n]).splice(r,1)};var w=new WeakMap,C=new function(){var e=this;this.add=function(t){var n=t.commit,r=t.key,i=t.binding;e.delete({commit:n,key:r}),e.get({commit:n})[r]=i},this.delete=function(t){var n=t.commit,r=t.key,i=e.get({commit:n}),o=i[r];o&&(o.unbind(),delete i[r])},this.get=function(e){var t=e.commit,n=w.get(t);return n||(n=Object.create(null),w.set(t,n)),n}},I={root:!0},g={root:!0},V={};Object.keys(A).forEach(function(e){var t=A[e];V[t]=function(e,n){_[t](n.state,n)}}),e.firebaseMutations=V,e.firebaseAction=function(e){return function(t,n){var r=t.state,i=t.commit;return t.bindFirebaseRef=function(e,t,n){return void 0===n&&(n={}),m({state:r,commit:i,key:e,source:t,options:n})},t.bindFirestoreRef=function(e,t,n){return void 0===n&&(n={}),y({state:r,commit:i,key:e,source:t,options:n})},t.unbindFirebaseRef=function(e){return C.delete({commit:i,key:e})},e(t,n)}},Object.defineProperty(e,"__esModule",{value:!0})});