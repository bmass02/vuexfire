/*!
 * vuexfire v2.3.0
 * (c) 2018 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.VuexFire={})}(this,function(e){"use strict";function n(e,n){for(var t=0;t<e.length;t++)if(e[t][".key"]===n)return t;return-1}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){if("function"!=typeof e)throw new Error("Must pass a function.");var n=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];e.apply(void 0,t),n=function(){}};return n}function i(e){return"function"==typeof e.key?e.key():e.key}function o(e){return e.hasOwnProperty("key")}function a(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function c(e){var n=e.val(),r=t(n)?n:{".value":n};return r[".key"]=i(e),r[".path"]=s(a(e)),r}function u(e){var n=e.exists?e.data():Object.create(null);return n[".id"]=e.id,n[".path"]=s(e.ref),n}function d(e){return"collection"in e}function s(e){if(!d(e)&&!o(e))throw new Error("Only Firestore DocumentReferences can be converted to a path.");for(var n=o(e)?i:function(e){return e.id},t=[],r=e;r;)t.unshift(n(r)),r=r.parent;return t.join("/")}function f(e){return"function"==typeof e.docChanges?e.docChanges():e.docChanges}function y(e){this.unbind=e}function l(e){var n=this;this.listeners={},this.unbind=function(){for(var t in n.listeners)e.off(t,n.listeners[t])},this.addListeners=function(e){Object.assign(n.listeners,e)}}function v(e){var n=e.key,t=e.source,r=e.onReadyCallback,i=e.onErrorCallback,o=e.wait,a=e.commit,c=e.state,d=(e.includeMetadataChanges,[]),s=function(){a(x,{type:x,state:c,key:n,value:d},F)};return o?t.get().then(s):s(),t.onSnapshot(function(e){f(e).forEach(function(e){switch(e.type){case"added":a(R,{type:R,state:c,key:n,index:e.newIndex,array:o&&d,record:u(e.doc)},F);break;case"modified":var t=u(e.doc);a(w,{type:w,state:c,key:n,index:e.oldIndex,array:o&&d,record:t},F),e.newIndex!==e.oldIndex&&a(A,{type:A,state:c,key:n,index:e.oldIndex,newIndex:e.newIndex,array:o&&d,record:t},F);break;case"removed":a(_,{type:_,state:c,key:n,index:e.oldIndex,array:o&&d},F)}}),r(e)},i)}function m(e){var n=e.key,t=e.source,r=e.onReadyCallback,i=e.onErrorCallback,o=e.commit,a=e.state,c=e.includeMetadataChanges;return t.onSnapshot({includeMetadataChanges:c},function(e){o(E,{type:E,key:n,record:u(e),state:a},F),r(e)},i)}function k(e){var n=e.state,i=e.commit,o=e.key,a=e.source,c=e.options,u=c.wait;void 0===u&&(u=!0);var s=c.includeMetadataChanges;return void 0===s&&(s=!1),new Promise(function(e,c){if(!t(a))throw new Error("VuexFire: invalid Firebase binding source.");if(!(o in n))throw new Error("VuexFire: cannot bind undefined property '"+o+"'. Define it on the state first.");V.delete({commit:i,key:o});var f,l=r(e);f=d(a)?m({key:o,source:a,onReadyCallback:l,onErrorCallback:c,commit:i,state:n,includeMetadataChanges:s}):v({key:o,source:a,onReadyCallback:l,onErrorCallback:c,wait:u,commit:i,state:n,includeMetadataChanges:s}),V.add({commit:i,key:o,binding:new y(f)})})}function h(e){var n=e.key,t=e.source,r=e.cancelCallback,i=e.commit,o=e.state;return{value:t.on("value",function(e){i(E,{type:E,key:n,record:c(e),state:o},O)},r)}}function p(e){var t=e.key,r=e.source,o=e.onCancel,a=e.wait,u=e.commit,d=e.state,s=[],f=function(){u(x,{type:x,state:d,key:t,value:s},O)};a?r.once("value",f):f();var y=r.on("child_added",function(e,r){var i=r?n(s,r)+1:0;u(R,{type:R,state:d,key:t,index:i,array:a&&s,record:c(e)},O)},o),l=r.on("child_removed",function(e){var r=n(s,i(e));u(_,{type:_,state:d,key:t,index:r,array:a&&s},O)},o);return{child_added:y,child_changed:r.on("child_changed",function(e){var r=n(s,i(e));u(w,{type:w,state:d,key:t,index:r,array:a&&s,record:c(e)},O)},o),child_removed:l,child_moved:r.on("child_moved",function(e,r){var o=n(s,i(e)),f=r?n(s,r)+1:0;u(A,{type:A,state:d,key:t,index:o,newIndex:f+=o<f?-1:0,array:a&&s,record:c(e)},O)},o)}}function b(e){var n=e.state,r=e.commit,i=e.key,o=e.source,c=e.options,u=c.onCancel,d=c.wait;return void 0===d&&(d=!0),new Promise(function(e,c){if(!t(o))throw new Error("VuexFire: invalid Firebase binding source.");if(!(i in n))throw new Error("VuexFire: cannot bind undefined property '"+i+"'. Define it on the state first.");var s=new l(a(o));V.add({commit:r,key:i,binding:s}),o.once("value",e,c);var f;f=n[i]&&"length"in n[i]?p({key:i,source:o,onCancel:u,wait:d,commit:r,state:n}):h({key:i,source:o,onCancel:u,commit:r,state:n}),s.addListeners(f)})}var E="vuexfire/OBJECT_VALUE",x="VUEXFIRE_ARRAY_INITIALIZE",R="vuexfire/ARRAY_ADD",w="vuexfire/ARRAY_CHANGE",A="vuexfire/ARRAY_MOVE",_="vuexfire/ARRAY_REMOVE",g=Object.freeze({VUEXFIRE_OBJECT_VALUE:E,VUEXFIRE_ARRAY_INITIALIZE:x,VUEXFIRE_ARRAY_ADD:R,VUEXFIRE_ARRAY_CHANGE:w,VUEXFIRE_ARRAY_MOVE:A,VUEXFIRE_ARRAY_REMOVE:_}),C={};C[E]=function(e,n){var t=n.key,r=n.record;e[t]=r},C[x]=function(e,n){var t=n.key,r=n.value;e[t]=r},C[R]=function(e,n){var t=n.key,r=n.index,i=n.record,o=n.array;(o=o||e[t]).splice(r,0,i)},C[w]=function(e,n){var t=n.key,r=n.index,i=n.record,o=n.array;(o=o||e[t]).splice(r,1,i)},C[A]=function(e,n){var t=n.key,r=n.index,i=(n.record,n.newIndex),o=n.array;(o=o||e[t]).splice(i,0,o.splice(r,1)[0])},C[_]=function(e,n){var t=n.key,r=n.index,i=n.array;(i=i||e[t]).splice(r,1)};var I=new WeakMap,V=new function(){var e=this;this.add=function(n){var t=n.commit,r=n.key,i=n.binding;e.delete({commit:t,key:r}),e.get({commit:t})[r]=i},this.delete=function(n){var t=n.commit,r=n.key,i=e.get({commit:t}),o=i[r];o&&(o.unbind(),delete i[r])},this.get=function(e){var n=e.commit,t=I.get(n);return t||(t=Object.create(null),I.set(n,t)),t}},F={root:!0},O={root:!0},M={};Object.keys(g).forEach(function(e){var n=g[e];M[n]=function(e,t){C[n](t.state,t)}}),e.firebaseMutations=M,e.firebaseAction=function(e){return function(n,t){var r=n.state,i=n.commit;return n.bindFirebaseRef=function(e,n,t){return void 0===t&&(t={}),b({state:r,commit:i,key:e,source:n,options:t})},n.bindFirestoreRef=function(e,n,t){return void 0===t&&(t={}),k({state:r,commit:i,key:e,source:n,options:t})},n.unbind=function(e){return V.delete({commit:i,key:e})},e(n,t)}},Object.defineProperty(e,"__esModule",{value:!0})});